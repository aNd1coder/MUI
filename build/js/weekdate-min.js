m_weekdate.WEEKDATE=7;function m_weekdate(){this.monthlengths="31,28,31,30,31,30,31,31,30,31,30,31".split(",");this.weekday="星期日,星期一,星期二,星期三,星期四,星期五,星期六".split(",");this.weeks="第一周,第二周,第三周,第四周,第五周,第六周".split(",");this.currentDate=date?date:new Date();this.year=this.currentDate.getYear();this.year=this.year<2000?1900+this.year:this.year;this.month=this.currentDate.getMonth();this.day=this.currentDate.getDay();this.date=this.currentDate.getDate();this.numdays=this.monthlengths[this.month];this.remainDate=null;this.l_scroll=false;this.r_scroll=false;this.l_Bt=$(".x-l-bt");this.r_Bt=$(".x-r-bt");this.x_hd=$(".x-hd");this.x_lis=$(".x-table li");this.x_month=$(".x-medium-month");this.x_date=$(".x-date");this.list=$(".x-list")}m_weekdate.prototype={init:function(b){var a=this;this.pre();this.scrollMonth(null);this.l_Bt.click(function(c){a.left(c)});this.r_Bt.click(function(c){a.right(c)})},scrollMonth:function(f){var c=this;this.numdays=this.monthlengths[this.month];if(1==this.month&&((this.year%4==0&&this.year%100!=0)||this.year%400==0)){this.numdays=29}if(f&&jQuery(f.target).hasClass("x-l-bt")){this.pre()}else{if(f&&jQuery(f.target).hasClass("x-r-bt")){this.next()}}var d=(parseInt(this.numdays)-this.startDate)>7?m_weekdate.WEEKDATE:(parseInt(this.numdays)-this.startDate+1);if(!m_weekdate.first){this._clear()}m_weekdate.first=false;for(var b=0;b<d;b++){if(this.remainDate!=undefined){if(b<=this.remainDate){continue}}if(this.remainDate!=undefined){var a=parseInt(this.startDate)+b-(this.remainDate+1);c.all_list(a);$(this.x_date.get(b)).text(a);$(this.x_lis.get(b)).hover((function(e){return function(g){c._show(this,c,e,g)}})(b),(function(e){return function(g){c._hide(this,c,e)}})(b))}else{var a=parseInt(this.startDate)+b;this.all_list(a);$(this.x_date.get(b)).text(a);$(this.x_lis.get(b)).hover((function(e){return function(g){c._show(this,c,e,g)}})(b),(function(e){return function(g){c._hide(this,c,e)}})(b))}}this.dispTime()},_clear:function(){this.x_date.unbind().empty();this.list.unbind().empty()},down_list:function(d){if(d==""||d==undefined){alert("日期不存在");return false}var date=new Date(this.year,this.month,parseInt(d));var curtime=date.getTime();$(".win-wrapper").css("display","block");$.ajax({type:"post",jsonp:"callBack",url:"../act/actinfo.do",data:"method=ajaxQueryByDate&actTime="+curtime+"&ACTSTATE=0",success:function(retext){var jsonObj=eval("("+retext+")");var str="";for(var i=0;i<jsonObj.length;i++){str=str+"<p class='m-line'><span class='m-flag-1'></span><span class='m-ct'>";if(jsonObj[i].ACTNAME.length>4){jsonObj[i].ACTNAME=jsonObj[i].ACTNAME.substring(0,4)+"..."}str=str+"<a href='"+jsonObj[i].ACT_URL+"' onclick=writeRecoderLook('"+jsonObj[i].ACTID+"','0')>"+jsonObj[i].ACTNAME+"</a></span><span class='m-time'>";str=str+jsonObj[i].BEGIN_DATE+"-"+jsonObj[i].END_DATE+"</span></p>"}$(".m-sub").html(str);$(".win-wrapper").css("display","block")}})},all_list:function(d){var date=new Date(this.year,this.month,d);var curtime=date.getTime();$(".x-table").html("");$.ajax({type:"post",jsonp:"callBack",url:"../act/actinfo.do",data:"method=ajaxQueryByDate1&actTime="+curtime+"&ACTSTATE=0",success:function(retext){var jsonObj=eval("("+retext+")");var str="";for(var i=0;i<jsonObj.length;i++){var jday=jsonObj[i].day;str=str+"<li class=''>";switch(jday){case 0:str=str+"<div class='x-hd'>周日</div>";break;case 1:str=str+"<div class='x-hd'>周一</div>";break;case 2:str=str+"<div class='x-hd'>周二</div>";break;case 3:str=str+"<div class='x-hd'>周三</div>";break;case 4:str=str+"<div class='x-hd'>周四</div>";break;case 5:str=str+"<div class='x-hd'>周五</div>";break;case 6:str=str+"<div class='x-hd'>周六</div>";break}str=str+"<div class='x-date'>"+jsonObj[i].date+"</div>";str=str+"<div class='x-list'>";for(var j=0;j<jsonObj[i].list.length;j++){if(j==0){str=str+"<p><a class='x-red' href='"+jsonObj[i].list[j].ACT_URL+"'>"+jsonObj[i].list[j].ACTNAME+"</a></p>"}else{str=str+"<p><a class='x-gray' href='"+jsonObj[i].list[j].ACT_URL+"'>"+jsonObj[i].list[j].ACTNAME+"</a></p>"}}str=str+"</div></li>"}$(".x-table").append(str)}})},_hide:function(a,e,c){var d=e.x_hd.get(c);var f=$(e.x_hd.get(c)).text();var b=setTimeout(function(){$(".win-wrapper").css("display","none");$(a).removeClass("x-hover");$(d).removeClass("x-hover")},1);$(".win-wrapper").hover(function(){clearTimeout(b)},function(){$(".win-wrapper").css("display","none");$(a).removeClass("x-hover");$(d).removeClass("x-hover")})},_show:function(c,e,d,f){$(c).addClass("x-hover");$(e.x_hd.get(d)).addClass("x-hover");var g=$(e.x_date.get(d)).text();var b=jQuery(f.currentTarget).get(0);setTimeout(function(){if($.browser.msie&&($.browser.version==6||$.browser.version==7)){var h=parseInt(b.offsetTop)+200;var a=parseInt(b.offsetLeft)-75}else{var h=parseInt(b.offsetTop)+155;var a=parseInt(b.offsetLeft)-95}$(".win-wrapper").css("top",h).css("left",a);e.down_list(g)},1)},left:function(a){this.scrollMonth(a)},right:function(a){this.scrollMonth(a)},dispTime:function(){var a=(this.year<2000?1900+this.year:this.year)+"年"+(this.month+1)+"月"+this.weeks[this.week];this.x_month.text(a)},cal:function(b){var c;if(b){c=new Date(b);var a=c.getDay();var d=1,f=2;var e=c.getDate();if(a==(m_weekdate.WEEKDATE-1)){for(;f>1;d++){f=parseInt(e)/(m_weekdate.WEEKDATE*d)}}else{e=e-(a+1);for(;f>1;d++){f=e/(m_weekdate.WEEKDATE*d)}}return d-1}else{c=new Date(this.year,this.month,this.numdays);var a=c.getDay();var d=3,f=2;var e=c.getDate();if(a==(m_weekdate.WEEKDATE-1)){for(;f>1;d++){f=parseInt(e)/(m_weekdate.WEEKDATE*d)}}else{e=e-(a+1);for(;f>1;d++){f=parseInt(e)/(m_weekdate.WEEKDATE*d)}}return d-1}},pre:function(){this.remainDate=undefined;if(this.startDate){if((this.startDate>1)&&(this.startDate<=m_weekdate.WEEKDATE)){this.startDate=1;this.l_scroll=true;var a=new Date(this.year,this.month,1);this.remainDate=a.getDay()-1;this.week=0}else{if(this.l_scroll){if(this.month==0){this.year-=1;this.month=11}else{this.month-=1}this.numdays=this.monthlengths[this.month];this.week=this.cal();var a=new Date(this.year,this.month,this.numdays);this.startDate=this.numdays-a.getDay();this.l_scroll=false;this.r_scroll=true}else{if(this.startDate==1){if(this.month==0){this.year-=1;this.month=11}else{this.month-=1}this.numdays=this.monthlengths[this.month];this.week=this.cal();var a=new Date(this.year,this.month,this.numdays);this.remainDate=a.getDay();this.startDate=parseInt(this.numdays)+1;this.r_scroll=true;this.l_scroll=false}else{this.startDate=this.startDate-m_weekdate.WEEKDATE;this.r_scroll=true;this.l_scroll=false;this.week--}}}}else{if(this.date<m_weekdate.WEEKDATE){this.startDate=1;this.week=0}else{this.week=this.cal(this.currentDate);this.startDate=this.date-this.day}}},next:function(){var b;if(this.remainDate!=undefined){b=this.startDate+(m_weekdate.WEEKDATE-(this.remainDate+1));this.remainDate=undefined}else{b=this.startDate+m_weekdate.WEEKDATE}if(b<=this.numdays){this.startDate=b;var a=new Date(this.year,this.month,this.numdays);var c=this.numdays-a.getDay();if(this.startDate==c){this.r_scroll=true}else{this.r_scroll=false;this.l_scroll=false}this.week++}else{if(this.r_scroll){var a=new Date(this.year,this.month,this.numdays);this.remainDate=a.getDay();if(this.month==11){this.year+=1;this.month=0}else{this.month+=1}this.week=0;this.numdays=this.monthlengths[this.month];this.startDate=1;this.r_scroll=false;this.l_scroll=true}}}};